<!doctype html>

<html lang="en">

<head>
  <title>网络基础: 交换机 (拾遗补缺) - 蛮荆</title>
  <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="" />
<meta name="author" content="" />
<link rel="shortcut icon" href="https://dbwu.tech/favicon.ico" type="image/x-icon" /><meta property="og:title" content="网络基础: 交换机 (拾遗补缺)" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://dbwu.tech/posts/network/switch/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-07-16T00:00:00+00:00" />
<meta property="article:modified_time" content="2017-07-16T00:00:00+00:00" />


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="网络基础: 交换机 (拾遗补缺)"/>
<meta name="twitter:description" content=""/>

<meta name="generator" content="Hugo 0.120.3">
    
    <script src="https://dbwu.tech/js/mathjax-config.js" defer></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-CZMGTTFLNY"></script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3261056100776781" crossorigin="anonymous"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-CZMGTTFLNY');
  </script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"
        onload="renderMathInElement(document.body);"></script>


  <link rel="stylesheet" href="https://dbwu.tech/fontawesome/css/normalize.min.css" />
  <link rel="stylesheet" href="https://dbwu.tech/fontawesome/css/all.min.css" />
  
    
    <link href="//fonts.googleapis.com/css?family=Staatliches" rel="stylesheet">
  
  
  <link rel="stylesheet" type="text/css" href="https://dbwu.tech/css/styles-light.css" />
  </head>

<body>
  <div id="container">
    <header>
      
      <h1>
        <a href="https://dbwu.tech/">蛮荆</a>
      </h1>

      <ul id="social-media">
      </ul>
      
    </header>

    
<nav>
    <ul>
        
        <li>
            <a class="active" href="https://dbwu.tech/posts/">
                <i class="fa-li fa  fa-lg"></i><span>归档</span>
            </a>
        </li>
        
        <li>
            <a class="" href="https://dbwu.tech/tags/">
                <i class="fa-li fa  fa-lg"></i><span>标签</span>
            </a>
        </li>
        
        <li>
            <a class="" href="https://github.com/duanbiaowu">
                <i class="fa-li fa  fa-lg"></i><span>Github</span>
            </a>
        </li>
        
        <li>
            <a class="" href="https://dbwu.tech/index.xml">
                <i class="fa-li fa  fa-lg"></i><span>RSS</span>
            </a>
        </li>
        
    </ul>
</nav>


    <main>




<article>

    <h1>网络基础: 交换机 (拾遗补缺)</h1>

    
      
<p>
    <span>2017-07-16</span>
    
    
    <a class="article-tag" href="https://dbwu.tech/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C">计算机网络</a>
    
</p>

    

    
      

    

    <h2 id="交换机和网卡">交换机和网卡</h2>
<p>可以简单地认为，交换机的每个网线接口后面都是一块网卡，网线接口和后面的电路部分加在一起称为一个 “端口”，也就是说交换机的一个端口就相当于计算机上的一块网卡。</p>
<p>交换机的工作方式和网卡的不同之处在于:</p>
<p>网卡本身具有 Mac 地址，收到到包之后，判断接收方 Mac 地址是不是自己，如果不是发给自己的包，直接丢弃。</p>
<p>交换机的端口不判断接收方 Mac 地址，而是将包存入到缓冲区，然后查询包的接收方 Mac 地址是否已经在 Mac 地址表中有记录了。</p>
<p>Mac 地址表主要包含两个信息:</p>
<ol>
<li>设备 (主机) 的 Mac 地址</li>
<li>设备 (主机) 连接在交换机的哪个端口上</li>
</ol>
<p>如图所示，Mac 地址和端口一一对应，通过 Mac 地址表可以快速判断出收到的包应该转发到哪个端口。</p>
<p><img src="https://dbwu.tech/images/network/epub_907755_260.jpg" alt="图片来源: 网络是怎样连接的(户根勤)"></p>
<hr>
<h2 id="mac-表的维护">Mac 表的维护</h2>
<p><img src="https://dbwu.tech/images/network/csg36-04-switch-learning-process.png" alt="交换机 Mac 地址表示例"></p>
<h3 id="写入">写入</h3>
<p>收到包时，将发送方 Mac 地址以及其输入端口的号码写入 Mac 地址表中。</p>
<p>由于收到包的端口连接着发送这个包的设备，所以只要将这个包的发送方 Mac 地址写入地址表即可。</p>
<p>后续再次收到发往这个地址的包时，交换机就可以将它转发到正确的端口了。</p>
<p>交换机每次收到包时都会执行这个操作，因此只要某个设备发送过网络包，它的 Mac 地址就会被记录到地址表中。</p>
<h3 id="删除">删除</h3>
<blockquote>
<p>地址表中的记录不能永久有效，应该一段时间不使用后就自动删除。</p>
</blockquote>
<p>删除地址表中某条记录，可以防止设备移动时产生问题。</p>
<p>例如开会时把笔记本电脑从办公桌拿到会议室，这时设备就发生了移动，从交换机的角度来看，就是本来 (无线 Wifi) 连接在某个端口上的笔记本电脑消失了。这时如果交换机收到了发往这台笔记本电脑的包，依然会将包转发到原来的端口，通信就会出错。</p>
<p>为了避免上述通信出错问题，必须定时删除过期的记录。</p>
<h3 id="更新">更新</h3>
<p>但是，交换机如何知道这台笔记本电脑已经从原来的端口 (位置) 移走了呢？其实很简单，只要笔记本电脑连接到会议室 (新的) 交换机，交换机就会根据笔记本电脑发出的包来更新它的地址表，这样，后续的通信就不会出错了。</p>
<h3 id="重启">重启</h3>
<p>当地址表的内容出现异常时，只要重启一下交换机就可以重置地址表，也不需要手动进行维护 (<del>果然，90% 的问题都可以通过重启解决</del>)。</p>
<hr>
<h2 id="特殊操作">特殊操作</h2>
<h3 id="目标端口和源端口相同">目标端口和源端口相同</h3>
<p>当交换机发现一个包的目标端口和源端口是同一个端口，就会直接丢弃这个包。</p>
<h3 id="找不到指定的-mac-地址">找不到指定的 Mac 地址</h3>
<p>如果交换机在 Mac 地址表中找不到指定的 Mac 地址，这可能是因为具有该地址的设备还没有向交换机发送过包，或者这个设备 (主机) 已经离线，导致其地址被删除了。</p>
<p>这种情况下，交换机无法判断应该把包转发到哪个端口，只能将包转发到除了源端口之外的所有端口上 (类似广播)，这样无论该设备连接在哪个端口上都能收到这个包 (当然，除了该设备外，其他设备收到包之后会直接丢弃)。</p>
<h3 id="广播">广播</h3>
<p>如果接收方 Mac 地址是一个广播地址，那么交换机会将包发送到除源端口之外的其他所有端口 (这里的端口指的是交换机上的 “网线接口”)。</p>
<blockquote>
<p>Mac 广播地址: FF:FF:FF:FF:FF:FF</p>
<p>IP 广播地址: 255.255.255.255</p>
</blockquote>
<p>如图所示，设备 1 发送了一个广播消息，然后被交换机转发到了设备 2 和设备 3。</p>
<p><img src="https://dbwu.tech/images/network/switch-broadcast-forwarding.jpg" alt="交换机广播示例"></p>
<hr>
<h2 id="三层交换机">三层交换机</h2>
<p>L3 (三层) 交换机是一种在 L2 (二层) 交换机的基础上增加了路由选择功能的网络硬件，能够基于硬件实现网络功能和转发分组。</p>
<p>L2 交换机可以通过使用 VLAN 分割广播域，但主机之间的包交换必须位于同一 VLAN 范围内，对位于不同 VLAN 上的主机进行通信时，则必须使用路由功能，因此需要在网络上添加额外的路由器。</p>
<p><img src="https://dbwu.tech/images/network/epub_26211960_378.jpg" alt="图片来源: 图解网络硬件(三轮贤一)"></p>
<p>L3 交换机无需其他路由器，自身就可以直接完成 VLAN 配置、不同 VLAN 之间的通信。</p>
<p><img src="https://dbwu.tech/images/network/epub_26211960_379.jpg" alt="图片来源: 图解网络硬件(三轮贤一)"></p>
<p>现代化的基础设施架构方案中，越来越多组织的内部网络核心交换机采用 L3 交换机。</p>
<h2 id="交换机-vs-集线器">交换机 VS 集线器</h2>
<h3 id="全双工模式">全双工模式</h3>
<p>全双工模式是交换机特有的工作模式，它可以同时进行发送和接收操作，集线器不支持。</p>
<p>使用集线器时，如果多台计算机同时发送信号，信号就会在集线器内部混杂在一起，进而无法使用，这种现象称为碰撞，是以太网的一个重要特征。</p>
<h3 id="转发">转发</h3>
<p>交换机只将包转发到具有特定 Mac 地址的主机所连接 (对应) 的端口，其他无关端口都是空闲的，这些空闲的端口可以传输其他的包，因此交换机可以同时转发多个包。</p>
<p>集线器会将输入的信号广播到所有的端口，如果同时输入多个信号就会发生碰撞，无法同时传输多路信号，因此从设备整体的转发能力来看，交换机要高于集线器。</p>
<hr>
<h2 id="fdb">FDB</h2>
<blockquote>
<p>转发表（Forwarding Information Base，FIB）存储了路由器或交换机用于转发数据包的路由信息，用于指导网络设备对数据包进行转发和路由选择，表中的每个条目包含目标网络地址、下一跳地址（或出接口）以及其他相关信息。</p>
</blockquote>
<p><code>网路邻接表</code> 表示网络设备上的邻居关系列表，存储了网络设备直接相连的其他设备的信息，如 Mac 地址、IP 地址等，主要用于维护设备之间的直接通信关系，以便进行数据包的交换和转发。</p>
<p><img src="https://dbwu.tech/images/network/epub_26211960_383.jpg" alt="图片来源: 图解网络硬件(三轮贤一)"></p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#999;font-style:italic"># 转发信息库示例</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Destination       Next Hop          Interface
</span></span><span style="display:flex;"><span>0.0.0.0/0         192.168.1.1       Ethernet0
</span></span><span style="display:flex;"><span>192.168.1.0/24    0.0.0.0           Ethernet1
</span></span><span style="display:flex;"><span>10.0.0.0/8        192.168.1.2       Ethernet2
</span></span></code></pre></div><p>所有目标 IP 为 0.0.0.0/0 的数据包，都会被转发到下一跳路由地址 192.168.1.1 (也可以称为网关)。</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#999;font-style:italic"># 邻接表示例</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Neighbor Device   Interface         Mac Address        IP Address
</span></span><span style="display:flex;"><span>Router1           Ethernet0         00:1A:2B:3C:4D:5E  192.168.1.1
</span></span><span style="display:flex;"><span>Switch1           Ethernet1         00:11:22:33:44:55  10.0.0.1
</span></span><span style="display:flex;"><span>Host1             Ethernet2         00:AA:BB:CC:DD:EE  192.168.1.10
</span></span></code></pre></div><p>下一跳路由地址 192.168.1.1 的路由设备，对应的 Mac 地址为 00:1A:2B:3C:4D:5E。</p>
<p>L3 交换机将转发表和邻接表整合成一份表，FDB（Forwarding Database，转发数据库），注册于内存中并通过硬件处理完成高速检索。</p>
<p>下面是 L3 交换机的内部处理示例图。</p>
<p><img src="https://dbwu.tech/images/network/epub_26211960_385.jpg" alt="图片来源: 图解网络硬件(三轮贤一)"></p>


</article>

<article>
    <img src="https://dbwu.tech/images/wechat.png">
</article>

<article>
    <h3>转载申请</h3>

    <p>
        本作品采用 <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">知识共享署名 4.0 国际许可协议</a> 进行许可，转载时请注明原文链接，图片在使用时请保留全部内容，商业转载请联系作者获得授权。
    </p>
</article>

<section class="post-nav">
    <ul>
        <li>
        
            <a href="https://dbwu.tech/posts/linux/tools/curl/"><i class="fa fa-chevron-circle-left"></i> curl 命令常用操作</a>
        
        </li>
        <li>
        
            <a href="https://dbwu.tech/posts/network/subnet/">网络基础: 公网/子网 地址是如何分类的？ <i class="fa fa-chevron-circle-right"></i> </a>
        
        </li>
    </ul>
</section>
  
    
    
  


<script src="https://giscus.app/client.js"
        data-repo="duanbiaowu/dbwu.tech"
        data-repo-id="R_kgDOIkkjjw"
        data-category="Announcements"
        data-category-id="DIC_kwDOIkkjj84CV78j"
        data-mapping="specific"
        data-term="网络基础: 交换机 (拾遗补缺)"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="1"
        data-input-position="top"
        data-theme="light"
        data-lang="zh-CN"
        crossorigin="anonymous" async>
</script>




</main>
    <footer>
        <ul>
            <li>
                <h6><a href="mailto:codean.net@gmail.com">codean.net@gmail.com</a> | 
                    <img src="https://dbwu.tech/images/%E5%A4%87%E6%A1%88%E5%9B%BE%E6%A0%87.png" />
                    <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=61011302001681" target="_blank">陕公网安备 61011302001681 号</a> |
                    <a href="https://beian.miit.gov.cn" target="_blank">陕ICP备2023004378号-1</a> |
                    Rendered by <a href="https://themes.gohugo.io" title="Hugo" target="_blank">Hugo</a>
                </h6>
            </li>
            
            
        </ul>
    </footer>
</div>
<script src="https://dbwu.tech/js/scripts.js"></script>


</body>

</html>

