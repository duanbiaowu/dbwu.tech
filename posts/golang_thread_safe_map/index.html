<!doctype html>

<html lang="en">

<head>
  <title>Go çº¿ç¨‹å®‰å…¨ map æ–¹æ¡ˆé€‰å‹ - è›®è†</title>
  <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="Go è¯­è¨€æ ‡å‡†åº“ä¸­çš„ map æ•°æ®ç±»å‹å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¤šä¸ª goroutine å¯ä»¥å¹¶å‘è¯»å–åŒä¸€ä¸ª map, ä½†æ˜¯ä¸èƒ½å¹¶å‘å†™å…¥åŒä¸€ä¸ª map, å¦åˆ™ä¼šå¼•å‘ panic, ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ &hellip;" />
<meta name="author" content="" />
<link rel="shortcut icon" href="https://dbwu.tech/favicon.ico" type="image/x-icon" /><meta property="og:title" content="Go çº¿ç¨‹å®‰å…¨ map æ–¹æ¡ˆé€‰å‹" />
<meta property="og:description" content="Go è¯­è¨€æ ‡å‡†åº“ä¸­çš„ map æ•°æ®ç±»å‹å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¤šä¸ª goroutine å¯ä»¥å¹¶å‘è¯»å–åŒä¸€ä¸ª map, ä½†æ˜¯ä¸èƒ½å¹¶å‘å†™å…¥åŒä¸€ä¸ª map, å¦åˆ™ä¼šå¼•å‘ panic, ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ &hellip;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://dbwu.tech/posts/golang_thread_safe_map/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-25T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-06-25T00:00:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Go çº¿ç¨‹å®‰å…¨ map æ–¹æ¡ˆé€‰å‹"/>
<meta name="twitter:description" content="Go è¯­è¨€æ ‡å‡†åº“ä¸­çš„ map æ•°æ®ç±»å‹å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¤šä¸ª goroutine å¯ä»¥å¹¶å‘è¯»å–åŒä¸€ä¸ª map, ä½†æ˜¯ä¸èƒ½å¹¶å‘å†™å…¥åŒä¸€ä¸ª map, å¦åˆ™ä¼šå¼•å‘ panic, ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ &hellip;"/>

<meta name="generator" content="Hugo 0.113.0">
    
    <script src="https://dbwu.tech/js/mathjax-config.js" defer></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-CZMGTTFLNY"></script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3261056100776781" crossorigin="anonymous"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-CZMGTTFLNY');
  </script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"
        onload="renderMathInElement(document.body);"></script>


  <link rel="stylesheet" href="https://dbwu.tech/fontawesome/css/normalize.min.css" />
  <link rel="stylesheet" href="https://dbwu.tech/fontawesome/css/all.min.css" />
  
    
    <link href="//fonts.googleapis.com/css?family=Staatliches" rel="stylesheet">
  
  
  <link rel="stylesheet" type="text/css" href="https://dbwu.tech/css/styles-light.css" />
  </head>

<body>
  <div id="container">
    <header>
      
      <h1>
        <a href="https://dbwu.tech/">è›®è†</a>
      </h1>

      <ul id="social-media">
      </ul>
      
    </header>

    
<nav>
    <ul>
        
        <li>
            <a class="active" href="https://dbwu.tech/posts/">
                <i class="fa-li fa  fa-lg"></i><span>å½’æ¡£</span>
            </a>
        </li>
        
        <li>
            <a class="" href="https://dbwu.tech/tags/">
                <i class="fa-li fa  fa-lg"></i><span>æ ‡ç­¾</span>
            </a>
        </li>
        
        <li>
            <a class="" href="https://github.com/duanbiaowu">
                <i class="fa-li fa  fa-lg"></i><span>Github</span>
            </a>
        </li>
        
        <li>
            <a class="" href="https://dbwu.tech/index.xml">
                <i class="fa-li fa  fa-lg"></i><span>RSS</span>
            </a>
        </li>
        
    </ul>
</nav>


    <main>




<article>

    <h1>Go çº¿ç¨‹å®‰å…¨ map æ–¹æ¡ˆé€‰å‹</h1>

    
      
<li>
    
    
    <a href="https://dbwu.tech/tags/golang">Golang</a>
    
    
    <a href="https://dbwu.tech/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B">å¹¶å‘ç¼–ç¨‹</a>
    
    
    <a href="https://dbwu.tech/tags/go-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90">Go æºç åˆ†æ</a>
    
    
    <a href="https://dbwu.tech/tags/%E8%AF%BB%E4%BB%A3%E7%A0%81">è¯»ä»£ç </a>
    
</li>

    

    
      

    

    <h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>
<p>Go è¯­è¨€æ ‡å‡†åº“ä¸­çš„ map æ•°æ®ç±»å‹å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¤šä¸ª <code>goroutine</code> å¯ä»¥å¹¶å‘è¯»å–åŒä¸€ä¸ª map, ä½†æ˜¯ä¸èƒ½å¹¶å‘å†™å…¥åŒä¸€ä¸ª map, å¦åˆ™ä¼šå¼•å‘ panicã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®é™…å¼€å‘ä¸­é€šå¸¸ä¼šä½¿ç”¨ä¸‹é¢çš„ä¸‰ç§æ–¹æ¡ˆä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ª:</p>
<ol>
<li>é€šè¿‡ map æ•°æ®ç±»å‹ + é” (äº’æ–¥é”, è¯»å†™é”)</li>
<li>æ ‡å‡†åº“å†…ç½®çš„ <code>sync.Map</code> å¯¹è±¡ (æ”¯æŒå¹¶å‘è¯»å†™)</li>
<li>åˆ†æ®µé”</li>
</ol>
<p>ä½œä¸ºè¡¥å……ï¼Œæœ¬æ–‡ä¼šé¡ºå¸¦å¯¹æ¯”ä¸€ä¸‹è‡ªæ—‹é”å’Œæ ‡å‡†åº“ä¸­çš„äº’æ–¥é”çš„æ€§èƒ½å·®å¼‚ï¼Œå¯¹äº map æ•°æ®ç±»å‹åŠå…¶æ“ä½œåŸè¯­æ¥è¯´ï¼Œä¸¤è€…å®ç°çš„åŠŸèƒ½ä¿è¯æ˜¯ä¸€è‡´çš„ï¼Œ
è€Œä¸”è‡ªæ—‹é”æ›´å¤šçš„åº”ç”¨åœºæ™¯åœ¨æ— é”ç¼–ç¨‹ï¼Œæ‰€ä»¥æ–‡ç« æœ«å°¾çš„åŸºå‡†æµ‹è¯•ä¸åŒ…å«è‡ªæ—‹é” (å½“ç„¶ï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥åœ¨æœ¬æ–‡åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹ï¼Œè‡ªè¡Œå¯¹æ¯”æµ‹è¯•ç»“æœ)ã€‚</p>
<p>ğŸ’¡ æœ¬æ–‡ä»£ç è¾ƒå¤šï¼Œå¯¹æµ‹è¯•è¿‡ç¨‹ä¸æ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥ç›´æ¥è·³è½¬åˆ°æ–‡ç« æœ«å°¾çœ‹ç»“è®ºã€‚</p>
<h2 id="è¯»å†™é”å’Œäº’æ–¥é”">è¯»å†™é”å’Œäº’æ–¥é”</h2>
<p>æ ‡å‡†åº“ä¸­çš„è¯»å†™é”å’Œäº’æ–¥é”çš„æ€§èƒ½å·®å¼‚åŠä½¿ç”¨åœºæ™¯ï¼Œåœ¨ä¹‹å‰çš„ <a href="https://golang.dbwu.tech/performance/mutex/">è¿™ç¯‡æ–‡ç« ä¸­</a> å·²ç»æœ‰åŸºç¡€çš„è¯´æ˜ï¼Œæœ¬æ–‡ä¸å†èµ˜è¿°ã€‚</p>
<h2 id="è‡ªæ—‹é”">è‡ªæ—‹é”</h2>
<p>åŸºç¡€æ¦‚å¿µåœ¨ <a href="https://dbwu.tech/posts/os_lock/">æ­»é”ã€æ´»é”ã€é¥¥é¥¿ã€è‡ªæ—‹é” ä¸€æ–‡ä¸­</a> å·²ç»ä»‹ç»è¿‡ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ï¼Œå…¶ä¸­è‡ªæ—‹é”æ“ä½œè·å–é”çš„æ ¸å¿ƒä»£ç å¦‚ä¸‹:</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#999;font-style:italic">// è·å–è‡ªæ—‹é”
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"></span><span style="color:#6ab825;font-weight:bold">func</span> (sl *spinLock) <span style="color:#447fcf">lock</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#6ab825;font-weight:bold">for</span> !atomic.<span style="color:#447fcf">CompareAndSwapUint32</span>((*<span style="color:#6ab825;font-weight:bold">uint32</span>)(sl), <span style="color:#3677a9">0</span>, <span style="color:#3677a9">1</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#999;font-style:italic">// è·å–åˆ°è‡ªæ—‹é”
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"></span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ä¸Šé¢çš„ä»£ç ç›´è§‚ä¸Šå¾ˆç¬¦åˆè‡ªæ—‹é”çš„è¯­ä¹‰ï¼Œåªè¦æ²¡æœ‰è·å–åˆ°é”ï¼Œå°±ä¸€ç›´ç©ºè½¬ CPU å°è¯•è·å–é”ï¼Œä½†æ˜¯è¿™ä¼šå¸¦æ¥ä¸€ä¸ªé—®é¢˜: CPU ç©ºè½¬å¸¦æ¥äº†å¾ˆå¤§çš„èµ„æºæµªè´¹ï¼Œ
æ˜¯å¦å¯ä»¥é™ä½ç”šè‡³é¿å…è¿™ç§èµ„æºæµªè´¹å—ï¼Ÿ</p>
<p>ä¸€ä¸ªæ˜¾è€Œæ˜“è§çš„æ–¹æ³•æ˜¯åœ¨æ¯ä¸¤æ¬¡è·å–é”çš„æ“ä½œä¹‹é—´ä¼‘çœ ä¸€ä¸‹ï¼Œä½†æ˜¯è¿™æ ·åšä¼šå¸¦æ¥ä¸¤ä¸ªæ–°çš„é—®é¢˜:</p>
<ol>
<li>å»¶è¿Ÿå¢åŠ ï¼Œæœ¬æ¥ä¹Ÿè®¸ä¸‹æ¬¡è·å–é”å°±å¯ä»¥æˆåŠŸï¼Œä½†æ˜¯ç°åœ¨å¿…é¡»ç­‰ä¼‘çœ ç»“æŸæ‰èƒ½ç»§ç»­è·å–é”</li>
<li>å¼•èµ·ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå› ä¸ºå½“å‰ goroutine ä¼‘çœ ï¼Œæ ¹æ® GMP è°ƒå–å™¨çš„ç®¡ç†è§„åˆ™ï¼Œå¤„ç†å™¨ P ä¼šåˆ‡æ¢åˆ°å…¶ä»–å¯ä»¥è¿è¡Œçš„ goroutine, å¦‚æœå½“å‰ P çš„ goroutine é˜Ÿåˆ—å·²ç»æ˜¯ç©ºçš„ï¼Œ
é‚£ä¹ˆä¼šç»™å½“å‰ M å…³è”ä¸€ä¸ªæ–°çš„å¤„ç†å™¨ï¼Œä¸ç®¡æ˜¯å“ªç§æƒ…å†µå‘ç”Ÿï¼Œéƒ½ä¼šå¼•èµ·ä¸Šä¸‹æ–‡åˆ‡æ¢</li>
</ol>
<h3 id="ä¼˜åŒ–ç‰ˆ">ä¼˜åŒ–ç‰ˆ</h3>
<p>çœ‹èµ·æ¥ä¼¼ä¹æ²¡æœ‰å®Œç¾çš„è§£å†³æ–¹æ¡ˆï¼Œç¬”è€…å‰ä¸¤ä¸¤å¤©åœ¨é˜…è¯» <a href="https://github.com/panjf2000/ants">ants</a> çš„æºä»£ç æ—¶ï¼Œçœ‹åˆ°ä½œè€…æ˜¯è¿™æ ·å¤„ç†è‡ªæ—‹é”çš„:</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">const</span> maxBackoff = <span style="color:#3677a9">16</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">func</span> (sl *spinLock) <span style="color:#447fcf">Lock</span>() {
</span></span><span style="display:flex;"><span>	backoff := <span style="color:#3677a9">1</span>
</span></span><span style="display:flex;"><span>	<span style="color:#6ab825;font-weight:bold">for</span> !atomic.<span style="color:#447fcf">CompareAndSwapUint32</span>((*<span style="color:#6ab825;font-weight:bold">uint32</span>)(sl), <span style="color:#3677a9">0</span>, <span style="color:#3677a9">1</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#6ab825;font-weight:bold">for</span> i := <span style="color:#3677a9">0</span>; i &lt; backoff; i++ {
</span></span><span style="display:flex;"><span>			runtime.<span style="color:#447fcf">Gosched</span>()
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		<span style="color:#6ab825;font-weight:bold">if</span> backoff &lt; maxBackoff {
</span></span><span style="display:flex;"><span>			backoff &lt;&lt;= <span style="color:#3677a9">1</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ä½œè€…å€Ÿé‰´äº† TCP æµé‡æ§åˆ¶ä¸­çš„æŒ‡æ•°é€€é¿ç†å¿µï¼Œæ¯ä¸¤æ¬¡è·å–é”çš„é—´éš”æ—¶é—´å‘ˆæŒ‡æ•°çº§åˆ«å¢é•¿ï¼Œå¹¶ä¸”åœ¨é—´éš”æ—¶é—´å†…æ‰§è¡Œ N æ¬¡ GMP è°ƒå–ï¼Œå½“ç„¶è¿™æ˜¯æ ¹æ®è¯¥ç»„ä»¶çš„åœºæ™¯ç‰¹æ€§å†³å®šçš„ (goroutine pool)ï¼Œ
åœ¨å®é™…é¡¹ç›®ä¸­å®ç°å’Œä½¿ç”¨è‡ªæ—‹é”æ—¶ï¼Œä¹Ÿå¯ä»¥æ ¹æ®å…·ä½“çš„ä¸šåŠ¡åœºæ™¯æ¥è‡ªå®šä¹‰é—´éš”æ—¶é—´å†…çš„æ“ä½œï¼Œæ¯”å¦‚å¯ä»¥æ‰§è¡Œä¸€ä¸ª CPU å¯†é›†å‹çš„ä»»åŠ¡ï¼Œ<strong>æœ€ç»ˆçš„ç›®çš„åªæœ‰ä¸€ä¸ª: å°½å¯èƒ½æ¦¨å¹² CPU èµ„æº</strong>ã€‚</p>
<h3 id="åŸºå‡†æµ‹è¯•">åŸºå‡†æµ‹è¯•</h3>
<p>é¦–å…ˆæ¥å¯¹æ ‡å‡†åº“ä¸­çš„äº’æ–¥é”ã€æ™®é€šè‡ªæ—‹é”ã€ä¼˜åŒ–ç‰ˆè‡ªæ—‹é”åšä¸€ä¸ªç®€å•çš„åŸºå‡†æµ‹è¯•ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#999;font-style:italic">// æ™®é€šè‡ªæ—‹é”å®ç° --------------------------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"></span><span style="color:#6ab825;font-weight:bold">type</span> originSpinLock <span style="color:#6ab825;font-weight:bold">uint32</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">func</span> (sl *originSpinLock) <span style="color:#447fcf">Lock</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#6ab825;font-weight:bold">for</span> !atomic.<span style="color:#447fcf">CompareAndSwapUint32</span>((*<span style="color:#6ab825;font-weight:bold">uint32</span>)(sl), <span style="color:#3677a9">0</span>, <span style="color:#3677a9">1</span>) {
</span></span><span style="display:flex;"><span>		runtime.<span style="color:#447fcf">Gosched</span>()
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">func</span> (sl *originSpinLock) <span style="color:#447fcf">Unlock</span>() {
</span></span><span style="display:flex;"><span>	atomic.<span style="color:#447fcf">StoreUint32</span>((*<span style="color:#6ab825;font-weight:bold">uint32</span>)(sl), <span style="color:#3677a9">0</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">func</span> <span style="color:#447fcf">NewOriginSpinLock</span>() sync.Locker {
</span></span><span style="display:flex;"><span>	<span style="color:#6ab825;font-weight:bold">return</span> <span style="color:#24909d">new</span>(originSpinLock)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic">// ä¼˜åŒ–è‡ªæ—‹é”å®ç° --------------------------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"></span><span style="color:#6ab825;font-weight:bold">type</span> spinLock <span style="color:#6ab825;font-weight:bold">uint32</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">const</span> maxBackoff = <span style="color:#3677a9">16</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">func</span> (sl *spinLock) <span style="color:#447fcf">Lock</span>() {
</span></span><span style="display:flex;"><span>	backoff := <span style="color:#3677a9">1</span>
</span></span><span style="display:flex;"><span>	<span style="color:#6ab825;font-weight:bold">for</span> !atomic.<span style="color:#447fcf">CompareAndSwapUint32</span>((*<span style="color:#6ab825;font-weight:bold">uint32</span>)(sl), <span style="color:#3677a9">0</span>, <span style="color:#3677a9">1</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#6ab825;font-weight:bold">for</span> i := <span style="color:#3677a9">0</span>; i &lt; backoff; i++ {
</span></span><span style="display:flex;"><span>			runtime.<span style="color:#447fcf">Gosched</span>()
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#6ab825;font-weight:bold">if</span> backoff &lt; maxBackoff {
</span></span><span style="display:flex;"><span>			backoff &lt;&lt;= <span style="color:#3677a9">1</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">func</span> (sl *spinLock) <span style="color:#447fcf">Unlock</span>() {
</span></span><span style="display:flex;"><span>	atomic.<span style="color:#447fcf">StoreUint32</span>((*<span style="color:#6ab825;font-weight:bold">uint32</span>)(sl), <span style="color:#3677a9">0</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">func</span> <span style="color:#447fcf">NewSpinLock</span>() sync.Locker {
</span></span><span style="display:flex;"><span>	<span style="color:#6ab825;font-weight:bold">return</span> <span style="color:#24909d">new</span>(spinLock)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic">// æ ‡å‡†åº“çš„äº’æ–¥é”
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"></span><span style="color:#6ab825;font-weight:bold">func</span> <span style="color:#447fcf">BenchmarkMutex</span>(b *testing.B) {
</span></span><span style="display:flex;"><span>	m := sync.Mutex{}
</span></span><span style="display:flex;"><span>	b.<span style="color:#447fcf">RunParallel</span>(<span style="color:#6ab825;font-weight:bold">func</span>(pb *testing.PB) {
</span></span><span style="display:flex;"><span>		<span style="color:#6ab825;font-weight:bold">for</span> pb.<span style="color:#447fcf">Next</span>() {
</span></span><span style="display:flex;"><span>			m.<span style="color:#447fcf">Lock</span>()
</span></span><span style="display:flex;"><span>			m.<span style="color:#447fcf">Unlock</span>()
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	})
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic">// æ™®é€šè‡ªæ—‹é”
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"></span><span style="color:#6ab825;font-weight:bold">func</span> <span style="color:#447fcf">BenchmarkSpinLock</span>(b *testing.B) {
</span></span><span style="display:flex;"><span>	spin := <span style="color:#447fcf">NewOriginSpinLock</span>()
</span></span><span style="display:flex;"><span>	b.<span style="color:#447fcf">RunParallel</span>(<span style="color:#6ab825;font-weight:bold">func</span>(pb *testing.PB) {
</span></span><span style="display:flex;"><span>		<span style="color:#6ab825;font-weight:bold">for</span> pb.<span style="color:#447fcf">Next</span>() {
</span></span><span style="display:flex;"><span>			spin.<span style="color:#447fcf">Lock</span>()
</span></span><span style="display:flex;"><span>			spin.<span style="color:#447fcf">Unlock</span>()
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	})
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic">// ä¼˜åŒ–ç‰ˆè‡ªæ—‹é”
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"></span><span style="color:#6ab825;font-weight:bold">func</span> <span style="color:#447fcf">BenchmarkBackOffSpinLock</span>(b *testing.B) {
</span></span><span style="display:flex;"><span>	spin := <span style="color:#447fcf">NewSpinLock</span>()
</span></span><span style="display:flex;"><span>	b.<span style="color:#447fcf">RunParallel</span>(<span style="color:#6ab825;font-weight:bold">func</span>(pb *testing.PB) {
</span></span><span style="display:flex;"><span>		<span style="color:#6ab825;font-weight:bold">for</span> pb.<span style="color:#447fcf">Next</span>() {
</span></span><span style="display:flex;"><span>			spin.<span style="color:#447fcf">Lock</span>()
</span></span><span style="display:flex;"><span>			spin.<span style="color:#447fcf">Unlock</span>()
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	})
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ä»æµ‹è¯•ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œä¼˜åŒ–åçš„è‡ªæ—‹é”ç›¸æ¯”æ™®é€šè‡ªæ—‹é”å’Œäº’æ–¥é”ï¼Œæ€§èƒ½æœ‰äº†å¾ˆå¤§çš„æé«˜ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>// goos: linux
</span></span><span style="display:flex;"><span>// goarch: amd64
</span></span><span style="display:flex;"><span>// cpu: Intel(R) Core(TM) i5-8300H CPU @ 2.30GHz
</span></span><span style="display:flex;"><span>// BenchmarkMutex
</span></span><span style="display:flex;"><span>// BenchmarkMutex-8                <span style="color:#3677a9">21886387</span>                55.83 ns/op
</span></span><span style="display:flex;"><span>// BenchmarkSpinLock
</span></span><span style="display:flex;"><span>// BenchmarkSpinLock-8             <span style="color:#3677a9">46848830</span>                25.81 ns/op
</span></span><span style="display:flex;"><span>// BenchmarkBackOffSpinLock
</span></span><span style="display:flex;"><span>// BenchmarkBackOffSpinLock-8      <span style="color:#3677a9">55894545</span>                21.16 ns/op
</span></span></code></pre></div><h2 id="åˆ†æ®µé”">åˆ†æ®µé”</h2>
<blockquote>
<p>åˆ†æ®µé” (Segmented Locking) æ˜¯ä¸€ç§å¹¶å‘æ§åˆ¶çš„æŠ€æœ¯ï¼Œå®ƒå°†å…±äº«èµ„æºåˆ’åˆ†æˆå¤šä¸ªä¸é‡å çš„ç‰‡æ®µï¼Œå¹¶å¯¹æ¯ä¸ªç‰‡æ®µè¿›è¡Œç‹¬ç«‹çš„åŠ é”ï¼Œé€šè¿‡è¿™ç§æ–¹æ³•å¯ä»¥å‡å°é”çš„ç²’åº¦ï¼Œæé«˜ç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½ã€‚</p>
</blockquote>
<p>ä½¿ç”¨åˆ†æ®µé”æ—¶ï¼Œæ¯ä¸ªçº¿ç¨‹åªéœ€è¦è·å– key æ‰€åœ¨çš„èŒƒå›´ç‰‡æ®µçš„é”ï¼Œè€Œä¸å¿…åƒäº’æ–¥é”é‚£æ ·é”ä½å¹¶ç‹¬å æ•´ä¸ªå…±äº«èµ„æºï¼Œæœ‰æ•ˆé¿å…äº†å¤šä¸ªçº¿ç¨‹å› ä¸ºç«äº‰å…¨å±€é”è€Œå¯¼è‡´çš„ç­‰å¾…å’Œå»¶è¿Ÿï¼Œæé«˜ç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½ã€‚</p>
<p>è™½ç„¶åˆ†æ®µé”å¯ä»¥æé«˜ç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½ï¼Œä½†åŒæ—¶ä¹Ÿä¼šå¢åŠ é”å†²çªçš„æ¦‚ç‡ï¼Œå¹¶ä¸”éœ€è¦ä»˜å‡ºé¢å¤–çš„å¼€é”€æ¥ç»´æŠ¤é”çš„çŠ¶æ€ (äº’æ–¥é”åªéœ€è¦ä¸€æŠŠå…¨å±€é”å³å¯ï¼Œåˆ†æ®µé”æ¯ä¸ªåŒºé—´èŒƒå›´éƒ½éœ€è¦ä¸€æŠŠé”)ã€‚</p>
<p><img src="https://dbwu.tech/images/thread_safe_map.png" alt="è¯»å†™é”å’Œåˆ†æ®µé”å·®å¼‚"></p>
<h3 id="ä»£ç å®ç°">ä»£ç å®ç°</h3>
<p>ç¬”è€…åœ¨é¡¹ç›®ä¸­ç”¨åˆ°çš„åˆ†æ®µé”ç»„ä»¶æ˜¯å¼€æºçš„ <a href="https://github.com/orcaman/concurrent-map">concurrent-map</a>, ä¸‹é¢å°±ä»¥è¯¥ç»„ä»¶çš„æºä»£ç ä¸ºåŸºç¡€ï¼Œæ¥åˆ†æå¦‚ä½•å®ç°ä¸€ä¸ªåˆ†æ®µé”ï¼Œæœ¬æ–‡é€‰ç”¨å®ç°äº†æ³›å‹çš„ v2 ç‰ˆæœ¬ã€‚</p>
<h3 id="map-å¯¹è±¡">Map å¯¹è±¡</h3>
<p><code>ConcurrentMap</code> å¯¹è±¡è¡¨ç¤ºå®ç°äº†åˆ†æ®µé”çš„ Map å¯¹è±¡ï¼Œå†…éƒ¨æœ‰ä¸¤ä¸ªå­—æ®µ:</p>
<ol>
<li>è¡¨ç¤ºåŒºåŸŸå…ƒç´ å¯¹è±¡çš„ shares å­—æ®µ</li>
<li>è¡¨ç¤ºå“ˆå¸Œå‡½æ•°çš„ sharding å­—æ®µ</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">type</span> ConcurrentMap[K comparable, V any] <span style="color:#6ab825;font-weight:bold">struct</span> {
</span></span><span style="display:flex;"><span>	shards   []*ConcurrentMapShared[K, V]
</span></span><span style="display:flex;"><span>	sharding <span style="color:#6ab825;font-weight:bold">func</span>(key K) <span style="color:#6ab825;font-weight:bold">uint32</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>GetShard</code> æ–¹æ³•ç”¨äºè®¡ç®—ç»™å®šçš„å‚æ•° key å¯¹åº”çš„åŒºé—´å…ƒç´ é›†åˆå¯¹è±¡å¹¶è¿”å›ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">func</span> (m ConcurrentMap[K, V]) <span style="color:#447fcf">GetShard</span>(key K) *ConcurrentMapShared[K, V] {
</span></span><span style="display:flex;"><span>	<span style="color:#999;font-style:italic">// ä¼˜åŒ–ç‰ˆ: m % n = m &amp; ( n - 1 )
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"></span>    <span style="color:#6ab825;font-weight:bold">return</span> m.shards[<span style="color:#24909d">uint</span>(m.<span style="color:#447fcf">sharding</span>(key))%<span style="color:#24909d">uint</span>(SHARD_COUNT)]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="åŒºé—´å…ƒç´ é›†åˆå¯¹è±¡">åŒºé—´å…ƒç´ é›†åˆå¯¹è±¡</h3>
<p><code>ConcurrentMapShared</code> å¯¹è±¡è¡¨ç¤º Map ä¸­æŸä¸ªåŒºé—´å…ƒç´ é›†åˆå¯¹è±¡ï¼Œå†…éƒ¨æœ‰ä¸¤ä¸ªå­—æ®µ:</p>
<ol>
<li>ç”¨äºå­˜å‚¨å…·ä½“å…ƒç´ çš„ map, æ•°æ®ç»“æ„å°±æ˜¯æ ‡å‡†åº“ä¸­çš„ map ç±»å‹</li>
<li>å†…åµŒä¸€ä¸ªè¯»å†™é”ï¼Œç”¨äºç®¡ç†å¯¹ map ç»“æ„çš„è¯»å†™å¹¶å‘æ§åˆ¶</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">type</span> ConcurrentMapShared[K comparable, V any] <span style="color:#6ab825;font-weight:bold">struct</span> {
</span></span><span style="display:flex;"><span>	items        <span style="color:#6ab825;font-weight:bold">map</span>[K]V
</span></span><span style="display:flex;"><span>	sync.RWMutex
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="æ“ä½œåŸè¯­">æ“ä½œåŸè¯­</h3>
<p>ä¸‹é¢æ¥çœ‹ä¸€ä¸‹å¸¸ç”¨çš„å‡ ä¸ªæ“ä½œåŸè¯­çš„ä»£ç å®ç°ã€‚</p>
<h4 id="1-set">1. SET</h4>
<p>æ–¹æ³•çš„å†…éƒ¨æ‰§è¡Œåˆ†ä¸º 4 æ­¥:</p>
<ol>
<li>é€šè¿‡ key è·å–åŒºé—´å…ƒç´ é›†åˆå¯¹è±¡</li>
<li><strong>è·å–å†™é”</strong></li>
<li>å†™å…¥ key å¯¹åº”çš„æ•°æ®</li>
<li><strong>é‡Šæ”¾å†™é”</strong></li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">func</span> (m ConcurrentMap[K, V]) <span style="color:#447fcf">Set</span>(key K, value V) {
</span></span><span style="display:flex;"><span>	shard := m.<span style="color:#447fcf">GetShard</span>(key)
</span></span><span style="display:flex;"><span>	shard.<span style="color:#447fcf">Lock</span>()
</span></span><span style="display:flex;"><span>	shard.items[key] = value
</span></span><span style="display:flex;"><span>	shard.<span style="color:#447fcf">Unlock</span>()
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="2-get">2. GET</h4>
<p>æ–¹æ³•çš„å†…éƒ¨æ‰§è¡Œåˆ†ä¸º 4 æ­¥:</p>
<ol>
<li>é€šè¿‡ key è·å–åŒºé—´å…ƒç´ é›†åˆå¯¹è±¡</li>
<li><strong>è·å–è¯»é”</strong></li>
<li>å†™å…¥ key å¯¹åº”çš„æ•°æ®</li>
<li><strong>é‡Šæ”¾è¯»é”</strong></li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">func</span> (m ConcurrentMap[K, V]) <span style="color:#447fcf">Get</span>(key K) (V, <span style="color:#6ab825;font-weight:bold">bool</span>) {
</span></span><span style="display:flex;"><span>	shard := m.<span style="color:#447fcf">GetShard</span>(key)
</span></span><span style="display:flex;"><span>	shard.<span style="color:#447fcf">RLock</span>()
</span></span><span style="display:flex;"><span>	val, ok := shard.items[key]
</span></span><span style="display:flex;"><span>	shard.<span style="color:#447fcf">RUnlock</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#6ab825;font-weight:bold">return</span> val, ok
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="3-has">3. Has</h4>
<p>å‡ºäº†è¿”å›å€¼ä¹‹å¤–ï¼Œå†…éƒ¨å®ç°å’Œ <code>GET</code> æ–¹æ³•å®ç°ä¸€è‡´ï¼Œè¿™é‡Œä¸åœ¨èµ˜è¿°ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">func</span> (m ConcurrentMap[K, V]) <span style="color:#447fcf">Has</span>(key K) <span style="color:#6ab825;font-weight:bold">bool</span> {
</span></span><span style="display:flex;"><span>	shard := m.<span style="color:#447fcf">GetShard</span>(key)
</span></span><span style="display:flex;"><span>	shard.<span style="color:#447fcf">RLock</span>()
</span></span><span style="display:flex;"><span>	_, ok := shard.items[key]
</span></span><span style="display:flex;"><span>	shard.<span style="color:#447fcf">RUnlock</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#6ab825;font-weight:bold">return</span> ok
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="4-remove">4. Remove</h4>
<p>æ–¹æ³•çš„å†…éƒ¨æ‰§è¡Œåˆ†ä¸º 4 æ­¥:</p>
<ol>
<li>é€šè¿‡ key è·å–åŒºé—´å…ƒç´ é›†åˆå¯¹è±¡</li>
<li><strong>è·å–å†™é”</strong></li>
<li>å†™å…¥ key å¯¹åº”çš„æ•°æ®</li>
<li><strong>é‡Šæ”¾å†™é”</strong></li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">func</span> (m ConcurrentMap[K, V]) <span style="color:#447fcf">Remove</span>(key K) {
</span></span><span style="display:flex;"><span>	shard := m.<span style="color:#447fcf">GetShard</span>(key)
</span></span><span style="display:flex;"><span>	shard.<span style="color:#447fcf">Lock</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#24909d">delete</span>(shard.items, key)
</span></span><span style="display:flex;"><span>	shard.<span style="color:#447fcf">Unlock</span>()
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="å“ˆå¸Œç®—æ³•">å“ˆå¸Œç®—æ³•</h3>
<blockquote>
<p>FNV32 æ˜¯ä¸€ç§å¿«é€Ÿå“ˆå¸Œå‡½æ•°ï¼Œé‡‡ç”¨ 32 ä½å“ˆå¸Œå€¼ï¼Œç®—æ³•å®ç°éå¸¸ç®€å•å¹¶ä¸”å…·æœ‰å¾ˆé«˜çš„æ€§èƒ½å’Œè¾ƒä½çš„å“ˆå¸Œç¢°æ’ç‡ã€‚</p>
</blockquote>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<code>concurrent-map</code> å¹¶æ²¡æœ‰ä½¿ç”¨æ ‡å‡†åº“çš„ <code>&quot;hash/fnv&quot;</code> æ–¹æ³•ä½œä¸ºæ±‚å†…éƒ¨å“ˆå¸Œå‡½æ•°å®ç°ï¼Œè€Œæ˜¯åœ¨ç»„ä»¶å†…éƒ¨é‡æ–°å®ç°äº†ä¸€ä¸ª <code>fnv32</code> å‡½æ•°ï¼Œ
ä½†æ˜¯ç®—æ³•ç”¨åˆ°çš„ç®—å­å¸¸æ•° <code>FNV_PRIME</code> å’Œ <code>FNV_OFFSET_BASIS</code>,  <code>concurrent-map</code> å’Œæ ‡å‡†åº“æ˜¯ä¿æŒä¸€è‡´çš„ï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥å¯¹æ¯”ä¸€ä¸‹å®ç°å·®å¼‚ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">func</span> strfnv32[K fmt.Stringer](key K) <span style="color:#6ab825;font-weight:bold">uint32</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">return</span> <span style="color:#447fcf">fnv32</span>(key.<span style="color:#447fcf">String</span>())
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">func</span> <span style="color:#447fcf">fnv32</span>(key <span style="color:#6ab825;font-weight:bold">string</span>) <span style="color:#6ab825;font-weight:bold">uint32</span> {
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>é™¤æ­¤ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ <code>NewWithCustomShardingFunction</code> å‡½æ•°åœ¨åˆ›å»º Map æ—¶æ¥æŒ‡å®šå“ˆå¸Œå‡½æ•°:</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">func</span> NewWithCustomShardingFunction[K comparable, V any](sharding <span style="color:#6ab825;font-weight:bold">func</span>(key K) <span style="color:#6ab825;font-weight:bold">uint32</span>) ConcurrentMap[K, V] {
</span></span><span style="display:flex;"><span>	<span style="color:#6ab825;font-weight:bold">return</span> create[K, V](sharding)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="syncmap">sync.Map</h2>
<p>æ ‡å‡†åº“ä¸­çš„ <code>sync.Map</code> çš„åº•å±‚å®ç°å’Œåº”ç”¨åœºæ™¯åœ¨ä¹‹å‰çš„ <a href="https://dbwu.tech/golang_sync_map/">è¿™ç¯‡æ–‡ç« ä¸­</a> å·²ç»æœ‰åŸºç¡€çš„è¯´æ˜ï¼Œæœ¬æ–‡ä¸å†èµ˜è¿°ã€‚</p>
<h2 id="åŸºå‡†æµ‹è¯•-1">åŸºå‡†æµ‹è¯•</h2>
<p>æœ€åï¼Œæˆ‘ä»¬å¯¹æ–‡ç« å¼€å¤´æåˆ°çš„ä¸‰ç§æ–¹æ¡ˆè¿›è¡ŒåŸºå‡†æµ‹è¯•ï¼Œæ ¹æ®æµ‹è¯•ç»“æœæ¥æ€»ç»“ä¸åŒæ–¹æ¡ˆçš„å„è‡ªé€‚ç”¨åœºæ™¯ã€‚</p>
<p>ä¸‹é¢çš„æµ‹è¯•ä»£ç åˆ†åˆ«å¯¹ è¯»å¤šå†™å°‘ã€è¯»å°‘å†™å¤šã€è¯»å†™å‡ç­‰è¿™ä¸‰ç§å¸¸è§çš„è´Ÿè½½åœºæ™¯ï¼Œè¿›è¡Œäº†æ€§èƒ½åŸºå‡†æµ‹è¯•:</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">package</span> maps
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#ed9d13">&#34;strconv&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ed9d13">&#34;sync&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#ed9d13">&#34;testing&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	cmap <span style="color:#ed9d13">&#34;github.com/orcaman/concurrent-map/v2&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic">// çº¿ç¨‹å®‰å…¨ Map æ¥å£
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"></span><span style="color:#6ab825;font-weight:bold">type</span> ThreadSafeMap <span style="color:#6ab825;font-weight:bold">interface</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#447fcf">Get</span>(key <span style="color:#6ab825;font-weight:bold">string</span>) any
</span></span><span style="display:flex;"><span>	<span style="color:#447fcf">Set</span>(key <span style="color:#6ab825;font-weight:bold">string</span>, val any)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic">// -------------------------------------------------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic">// map æ•°æ®ç±»å‹ + è¯»å†™é”å®ç°çº¿ç¨‹å®‰å…¨çš„ map
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"></span><span style="color:#6ab825;font-weight:bold">type</span> MutexMap <span style="color:#6ab825;font-weight:bold">struct</span> {
</span></span><span style="display:flex;"><span>	sync.RWMutex
</span></span><span style="display:flex;"><span>	m <span style="color:#6ab825;font-weight:bold">map</span>[<span style="color:#6ab825;font-weight:bold">string</span>]any
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">func</span> (m *MutexMap) <span style="color:#447fcf">Get</span>(key <span style="color:#6ab825;font-weight:bold">string</span>) any {
</span></span><span style="display:flex;"><span>	m.<span style="color:#447fcf">RLock</span>()
</span></span><span style="display:flex;"><span>	v, ok := m.m[key]
</span></span><span style="display:flex;"><span>	m.<span style="color:#447fcf">RUnlock</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#6ab825;font-weight:bold">if</span> ok {
</span></span><span style="display:flex;"><span>		<span style="color:#6ab825;font-weight:bold">return</span> v
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#6ab825;font-weight:bold">return</span> <span style="color:#6ab825;font-weight:bold">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">func</span> (m *MutexMap) <span style="color:#447fcf">Set</span>(key <span style="color:#6ab825;font-weight:bold">string</span>, val any) {
</span></span><span style="display:flex;"><span>	m.<span style="color:#447fcf">Lock</span>()
</span></span><span style="display:flex;"><span>	m.m[key] = val
</span></span><span style="display:flex;"><span>	m.<span style="color:#447fcf">Unlock</span>()
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic">// -------------------------------------------------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic">// sync.Map å®ç°çº¿ç¨‹å®‰å…¨çš„ map
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"></span><span style="color:#6ab825;font-weight:bold">type</span> SyncMap <span style="color:#6ab825;font-weight:bold">struct</span> {
</span></span><span style="display:flex;"><span>	m sync.Map
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">func</span> (s *SyncMap) <span style="color:#447fcf">Get</span>(key <span style="color:#6ab825;font-weight:bold">string</span>) any {
</span></span><span style="display:flex;"><span>	v, _ := s.m.<span style="color:#447fcf">Load</span>(key)
</span></span><span style="display:flex;"><span>	<span style="color:#6ab825;font-weight:bold">return</span> v
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">func</span> (s *SyncMap) <span style="color:#447fcf">Set</span>(key <span style="color:#6ab825;font-weight:bold">string</span>, val any) {
</span></span><span style="display:flex;"><span>	s.m.<span style="color:#447fcf">Store</span>(key, val)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic">// -------------------------------------------------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic">// åˆ†æ®µé”å®ç°çº¿ç¨‹å®‰å…¨çš„ map
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"></span><span style="color:#6ab825;font-weight:bold">type</span> ConcurMap <span style="color:#6ab825;font-weight:bold">struct</span> {
</span></span><span style="display:flex;"><span>	m cmap.ConcurrentMap[<span style="color:#6ab825;font-weight:bold">string</span>, any]
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">func</span> (c *ConcurMap) <span style="color:#447fcf">Get</span>(key <span style="color:#6ab825;font-weight:bold">string</span>) any {
</span></span><span style="display:flex;"><span>	v, _ := c.m.<span style="color:#447fcf">Get</span>(key)
</span></span><span style="display:flex;"><span>	<span style="color:#6ab825;font-weight:bold">return</span> v
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">func</span> (c *ConcurMap) <span style="color:#447fcf">Set</span>(key <span style="color:#6ab825;font-weight:bold">string</span>, val any) {
</span></span><span style="display:flex;"><span>	c.m.<span style="color:#447fcf">Set</span>(key, val)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic">// åŸºå‡†æµ‹è¯•
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"></span><span style="color:#6ab825;font-weight:bold">func</span> <span style="color:#447fcf">benchmark</span>(b *testing.B, m ThreadSafeMap, read, write <span style="color:#6ab825;font-weight:bold">int</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#6ab825;font-weight:bold">for</span> i := <span style="color:#3677a9">0</span>; i &lt; b.N; i++ {
</span></span><span style="display:flex;"><span>		<span style="color:#6ab825;font-weight:bold">var</span> wg sync.WaitGroup
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#999;font-style:italic">// æ³¨æ„: è¿™é‡Œçš„è¯»å†™æ“ä½œæœ‰ä¸€éƒ¨åˆ† key æ˜¯é‡åˆçš„
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"></span>
</span></span><span style="display:flex;"><span>		<span style="color:#999;font-style:italic">// è¯»æ“ä½œ
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"></span>		<span style="color:#6ab825;font-weight:bold">for</span> k := <span style="color:#3677a9">0</span>; k &lt; read*<span style="color:#3677a9">100</span>; k++ {
</span></span><span style="display:flex;"><span>			wg.<span style="color:#447fcf">Add</span>(<span style="color:#3677a9">1</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#6ab825;font-weight:bold">go</span> <span style="color:#6ab825;font-weight:bold">func</span>(key <span style="color:#6ab825;font-weight:bold">int</span>) {
</span></span><span style="display:flex;"><span>				m.<span style="color:#447fcf">Get</span>(strconv.<span style="color:#447fcf">Itoa</span>(i * key))
</span></span><span style="display:flex;"><span>				wg.<span style="color:#447fcf">Done</span>()
</span></span><span style="display:flex;"><span>			}(k)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#999;font-style:italic">// å†™æ“ä½œ
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"></span>		<span style="color:#6ab825;font-weight:bold">for</span> k := <span style="color:#3677a9">0</span>; k &lt; write*<span style="color:#3677a9">100</span>; k++ {
</span></span><span style="display:flex;"><span>			wg.<span style="color:#447fcf">Add</span>(<span style="color:#3677a9">1</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#6ab825;font-weight:bold">go</span> <span style="color:#6ab825;font-weight:bold">func</span>(key <span style="color:#6ab825;font-weight:bold">int</span>) {
</span></span><span style="display:flex;"><span>				m.<span style="color:#447fcf">Set</span>(strconv.<span style="color:#447fcf">Itoa</span>(i*key), key)
</span></span><span style="display:flex;"><span>				wg.<span style="color:#447fcf">Done</span>()
</span></span><span style="display:flex;"><span>			}(k)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		wg.<span style="color:#447fcf">Wait</span>()
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic">// è¯»å†™æ¯”ä¾‹ 9:1
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"></span><span style="color:#6ab825;font-weight:bold">func</span> <span style="color:#447fcf">BenchmarkReadMoreRWMutex</span>(b *testing.B)   { <span style="color:#447fcf">benchmark</span>(b, &amp;MutexMap{m: <span style="color:#24909d">make</span>(<span style="color:#6ab825;font-weight:bold">map</span>[<span style="color:#6ab825;font-weight:bold">string</span>]any)}, <span style="color:#3677a9">9</span>, <span style="color:#3677a9">1</span>) }
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">func</span> <span style="color:#447fcf">BenchmarkReadMoreSyncMap</span>(b *testing.B)   { <span style="color:#447fcf">benchmark</span>(b, &amp;SyncMap{m: sync.Map{}}, <span style="color:#3677a9">9</span>, <span style="color:#3677a9">1</span>) }
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">func</span> <span style="color:#447fcf">BenchmarkReadMoreConcurMap</span>(b *testing.B) { <span style="color:#447fcf">benchmark</span>(b, &amp;ConcurMap{m: cmap.New[any]()}, <span style="color:#3677a9">9</span>, <span style="color:#3677a9">1</span>) }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic">// è¯»å†™æ¯”ä¾‹ 1:9
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"></span><span style="color:#6ab825;font-weight:bold">func</span> <span style="color:#447fcf">BenchmarkWriteMoreRWMutex</span>(b *testing.B)   { <span style="color:#447fcf">benchmark</span>(b, &amp;MutexMap{m: <span style="color:#24909d">make</span>(<span style="color:#6ab825;font-weight:bold">map</span>[<span style="color:#6ab825;font-weight:bold">string</span>]any)}, <span style="color:#3677a9">1</span>, <span style="color:#3677a9">9</span>) }
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">func</span> <span style="color:#447fcf">BenchmarkWriteMoreSyncMap</span>(b *testing.B)   { <span style="color:#447fcf">benchmark</span>(b, &amp;SyncMap{m: sync.Map{}}, <span style="color:#3677a9">1</span>, <span style="color:#3677a9">9</span>) }
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">func</span> <span style="color:#447fcf">BenchmarkWriteMoreConcurMap</span>(b *testing.B) { <span style="color:#447fcf">benchmark</span>(b, &amp;ConcurMap{m: cmap.New[any]()}, <span style="color:#3677a9">1</span>, <span style="color:#3677a9">9</span>) }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic">// è¯»å†™æ¯”ä¾‹ 5:5
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"></span><span style="color:#6ab825;font-weight:bold">func</span> <span style="color:#447fcf">BenchmarkEqualRWMutex</span>(b *testing.B)   { <span style="color:#447fcf">benchmark</span>(b, &amp;MutexMap{m: <span style="color:#24909d">make</span>(<span style="color:#6ab825;font-weight:bold">map</span>[<span style="color:#6ab825;font-weight:bold">string</span>]any)}, <span style="color:#3677a9">5</span>, <span style="color:#3677a9">5</span>) }
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">func</span> <span style="color:#447fcf">BenchmarkEqualSyncMap</span>(b *testing.B)   { <span style="color:#447fcf">benchmark</span>(b, &amp;SyncMap{m: sync.Map{}}, <span style="color:#3677a9">5</span>, <span style="color:#3677a9">5</span>) }
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">func</span> <span style="color:#447fcf">BenchmarkEqualConcurMap</span>(b *testing.B) { <span style="color:#447fcf">benchmark</span>(b, &amp;ConcurMap{m: cmap.New[any]()}, <span style="color:#3677a9">5</span>, <span style="color:#3677a9">5</span>) }
</span></span></code></pre></div><p>è¿è¡ŒåŸºå‡†æµ‹è¯•:</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ go <span style="color:#24909d">test</span> -count=<span style="color:#3677a9">1</span> -run=<span style="color:#ed9d13">&#39;^$&#39;</span> -bench=. -benchtime=3s  -benchmem
</span></span></code></pre></div><p>è¾“å‡ºç»“æœå¦‚ä¸‹:</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>goos: linux
</span></span><span style="display:flex;"><span>goarch: amd64
</span></span><span style="display:flex;"><span>cpu: Intel(R) Core(TM) i5-8300H CPU @ 2.30GHz
</span></span><span style="display:flex;"><span>BenchmarkReadMoreRWMutex-8                  <span style="color:#3677a9">9107</span>            <span style="color:#3677a9">362827</span> ns/op           <span style="color:#3677a9">84094</span> B/op       <span style="color:#3677a9">3001</span> allocs/op
</span></span><span style="display:flex;"><span>BenchmarkReadMoreSyncMap-8                  <span style="color:#3677a9">7740</span>            <span style="color:#3677a9">765258</span> ns/op          <span style="color:#3677a9">128974</span> B/op       <span style="color:#3677a9">3284</span> allocs/op
</span></span><span style="display:flex;"><span>BenchmarkReadMoreConcurMap-8               <span style="color:#3677a9">10000</span>            <span style="color:#3677a9">345271</span> ns/op           <span style="color:#3677a9">83985</span> B/op       <span style="color:#3677a9">3000</span> allocs/op
</span></span><span style="display:flex;"><span>BenchmarkWriteMoreRWMutex-8                 <span style="color:#3677a9">6212</span>            <span style="color:#3677a9">825778</span> ns/op          <span style="color:#3677a9">137330</span> B/op       <span style="color:#3677a9">3656</span> allocs/op
</span></span><span style="display:flex;"><span>BenchmarkWriteMoreSyncMap-8                 <span style="color:#3677a9">3352</span>           <span style="color:#3677a9">1155236</span> ns/op          <span style="color:#3677a9">157766</span> B/op       <span style="color:#3677a9">6041</span> allocs/op
</span></span><span style="display:flex;"><span>BenchmarkWriteMoreConcurMap-8               <span style="color:#3677a9">9480</span>            <span style="color:#3677a9">370214</span> ns/op          <span style="color:#3677a9">119970</span> B/op       <span style="color:#3677a9">3653</span> allocs/op
</span></span><span style="display:flex;"><span>BenchmarkEqualRWMutex-8                     <span style="color:#3677a9">7108</span>            <span style="color:#3677a9">529450</span> ns/op          <span style="color:#3677a9">104626</span> B/op       <span style="color:#3677a9">3249</span> allocs/op
</span></span><span style="display:flex;"><span>BenchmarkEqualSyncMap-8                     <span style="color:#3677a9">5360</span>            <span style="color:#3677a9">735393</span> ns/op          <span style="color:#3677a9">133008</span> B/op       <span style="color:#3677a9">4601</span> allocs/op
</span></span><span style="display:flex;"><span>BenchmarkEqualConcurMap-8                   <span style="color:#3677a9">9548</span>            <span style="color:#3677a9">347809</span> ns/op          <span style="color:#3677a9">104303</span> B/op       <span style="color:#3677a9">3250</span> allocs/op
</span></span><span style="display:flex;"><span>PASS
</span></span></code></pre></div><p>ä»åŸºå‡†æµ‹è¯•çš„è¾“å‡ºç»“æœæ¥çœ‹ï¼Œä¸è®ºæ˜¯å“ªç§åº”ç”¨åœºæ™¯ï¼Œç»“åˆè¿è¡Œé€Ÿåº¦è¿˜æ˜¯å†…å­˜åˆ†é…ï¼Œä¸‰è€…çš„æ’åºéƒ½æ˜¯ä¸€è‡´çš„: <strong>åˆ†æ®µé”ä¼˜äºè¯»å†™é” + map, åè€…ä¼˜äº sync.Map</strong> ã€‚
ç¬”è€…æ²¡æœ‰é‡åˆ°è¿‡ 100% çš„åªè¯»æˆ–åªå†™æ“ä½œçš„åº”ç”¨åœºæ™¯ï¼Œæ‰€ä»¥æ²¡æœ‰åšå¯¹åº”çš„åŸºå‡†æµ‹è¯•ï¼Œä¸è¿‡è¿™é‡Œå¯ä»¥çŒœæµ‹ä¸€ä¸‹:</p>
<ol>
<li>100% åªè¯»åœºæ™¯ä¸‹ sync.Map çš„æ€§èƒ½æœ€å¥½ (ä¸è¿‡æ—¢ç„¶éƒ½ 100% åªè¯»äº†, ç›´æ¥ä½¿ç”¨ map ç±»å‹å³å¯ï¼Œå› ä¸ºæ— éœ€åŠ é”ï¼Œæ‰€ä»¥æ€§èƒ½è‚¯å®šæœ€é«˜)</li>
<li>100% åªå†™åœºæ™¯ä¸‹ åˆ†æ®µé” çš„æ€§èƒ½æœ€å¥½</li>
</ol>
<p>æ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥é€šè¿‡è°ƒæ•´åŸºå‡†æµ‹è¯•ä»£ç çš„ç™¾åˆ†æ¯”å‚æ•°æ¥éªŒè¯ä¸€ä¸‹ï¼Œè¿™é‡Œæ˜¯ <a href="https://github.com/orcaman/concurrent-map/blob/master/concurrent_map_bench_test.go">concurrent-map å®˜æ–¹çš„åŸºå‡†æµ‹è¯•ä»£ç </a>ã€‚</p>
<h2 id="å°ç»“">å°ç»“</h2>
<p>æœ¬æ–‡ä¸»è¦ä»‹ç»äº†åœ¨ Go è¯­è¨€ä¸­å¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨çš„ map çš„ä¸‰ç§æ–¹æ³•ï¼Œå¹¶é€šè¿‡ä¸‰ç§å¸¸è§çš„ä¸šåŠ¡åœºæ™¯å¯¹æ–¹æ³•è¿›è¡Œäº†æ€§èƒ½åŸºå‡†æµ‹è¯•ï¼Œæœ€åï¼Œæˆ‘ä»¬æ¥ç®€å•æ€»ç»“ä¸‹ä¸‰ç§æ–¹æ³•çš„ç‰¹ç‚¹ã€‚</p>
<table>
<thead>
<tr>
<th>æ–¹æ¡ˆ</th>
<th>ä¼˜ç‚¹</th>
<th>ä¸è¶³</th>
</tr>
</thead>
<tbody>
<tr>
<td>è¯»å†™é” + map</td>
<td>è‡ªå®šä¹‰æ€§æœ€å¼ºï¼Œæ€§èƒ½é€‚ä¸­</td>
<td>éœ€è¦å¼€å‘å®ç°</td>
</tr>
<tr>
<td>sync.Map</td>
<td>æ ‡å‡†åº“è‡ªå¸¦ï¼Œå¼€ç®±å³ç”¨ï¼Œæ–¹ä¾¿çœå¿ƒ</td>
<td>æ€§èƒ½è¾ƒä½, API å‚æ•°ç±»å‹æ˜¯ anyï¼Œéœ€è¦æ•°æ®ç±»å‹è½¬æ¢</td>
</tr>
<tr>
<td>åˆ†æ®µé”</td>
<td>æ€§èƒ½æœ€å¥½</td>
<td>æ ‡å‡†åº“æœªæä¾›ï¼Œéœ€è¦å¼•å…¥ç¬¬ä¸‰æ–¹ç»„ä»¶</td>
</tr>
</tbody>
</table>
<h2 id="reference">Reference</h2>
<ul>
<li><a href="https://github.com/orcaman/concurrent-map">concurrent-map</a></li>
</ul>
<h2 id="æ‰©å±•é˜…è¯»">æ‰©å±•é˜…è¯»</h2>
<ul>
<li><a href="https://dbwu.tech/posts/golang_lockfree/">Go æ— é”ç¼–ç¨‹</a></li>
<li><a href="https://halfrost.com/go_map_chapter_one/#toc-22">Map å®ç°ä¸­çš„ä¸€äº›ä¼˜åŒ–</a></li>
<li><a href="https://blog.joway.io/posts/modern-memory-cache/">è®¾è®¡å®ç°é«˜æ€§èƒ½æœ¬åœ°å†…å­˜ç¼“å­˜</a></li>
</ul>


</article>

<article>
    <img src="https://dbwu.tech/images/wechat.png">
</article>

<article>
    <h3>è½¬è½½ç”³è¯·</h3>

    <p>
        æœ¬ä½œå“é‡‡ç”¨ <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">çŸ¥è¯†å…±äº«ç½²å 4.0 å›½é™…è®¸å¯åè®®</a> è¿›è¡Œè®¸å¯ï¼Œè½¬è½½æ—¶è¯·æ³¨æ˜åŸæ–‡é“¾æ¥ï¼Œå›¾ç‰‡åœ¨ä½¿ç”¨æ—¶è¯·ä¿ç•™å…¨éƒ¨å†…å®¹ï¼Œå•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒã€‚
    </p>
</article>

<section class="post-nav">
    <ul>
        <li>
        
            <a href="https://dbwu.tech/posts/bloom_filter/"><i class="fa fa-chevron-circle-left"></i> å¸ƒéš†è¿‡æ»¤å™¨</a>
        
        </li>
        <li>
        
            <a href="https://dbwu.tech/posts/golang_ants/">ants Code Reading <i class="fa fa-chevron-circle-right"></i> </a>
        
        </li>
    </ul>
</section>
  
    
    
  


<script src="https://giscus.app/client.js"
        data-repo="duanbiaowu/dbwu.tech"
        data-repo-id="R_kgDOIkkjjw"
        data-category="Announcements"
        data-category-id="DIC_kwDOIkkjj84CV78j"
        data-mapping="specific"
        data-term="Go çº¿ç¨‹å®‰å…¨ map æ–¹æ¡ˆé€‰å‹"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="1"
        data-input-position="top"
        data-theme="light"
        data-lang="zh-CN"
        crossorigin="anonymous" async>
</script>




</main>
    <footer>
        <ul>
            <li>
                <h6><a href="mailto:codean.net@gmail.com">codean.net@gmail.com</a> | 
                    <img src="https://dbwu.tech/images/%E5%A4%87%E6%A1%88%E5%9B%BE%E6%A0%87.png" />
                    <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=61011302001681" target="_blank">é™•å…¬ç½‘å®‰å¤‡ 61011302001681 å·</a> |
                    <a href="https://beian.miit.gov.cn" target="_blank">é™•ICPå¤‡2023004378å·-1</a> |
                    Rendered by <a href="https://themes.gohugo.io" title="Hugo" target="_blank">Hugo</a>
                </h6>
            </li>
            
            
        </ul>
    </footer>
</div>
<script src="https://dbwu.tech/js/scripts.js"></script>


</body>

</html>

